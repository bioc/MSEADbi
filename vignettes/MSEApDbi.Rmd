---
title: "Introduction to MSEApDbi and MSEAp.XXX.pb.db packages"
author: "by Kozo Nishida, Koki Tsuyuzaki, Atsushi Fukushima"
date: "`r Sys.Date()`"
output: BiocStyle::html_document
package: MSEApDbi
vignette: |
    %\VignetteIndexEntry{MSEApDbi}
    %\VignetteEncoding{UTF-8}
    %\VignetteEngine{knitr::rmarkdown}
---

## Introduction

MSEApDbi makes it easy to generate your own annotation package for MSEA.
The package design is the same as
[MeSHDbi](https://www.bioconductor.org/packages/release/bioc/html/MeSHDbi.html)
and
[LRBaseDbi](https://bioconductor.org/packages/release/bioc/html/LRBaseDbi.html),
and the usage is also the same.

This document provides the way to use MSEApDbi and MSEAp.XXX.pb.db packages.
MSEAp.XXX.pb.db packages provide the metabolite set by pathway for XXX species
in the [PathBank](https://pathbank.org/) database.
The packages are generated by the MSEApDbi package.
MSEApDbi has a role; the construction of MSEAp.XXX.pb.db packages.
The makeMSEApPackage function of MSEApDbi generates the user's original
MSEAp.XXX.pb.db packages.

## makeMSEApPackage

Here we use makeMSEApPackage function to create a MSEAp.XXX.pb.db package.
Only user have to specify are 1. a csv file that is filtered to include only the
lines of a species in [PathBank Data File](https://pathbank.org/downloads)
(Metabolite names linked to PathBank primary pathways CSV) and 2. a meta
table describing the PathBank data.
Here we use the demo data of Arabidopsis thaliana of PathBank primary pathways
CSV.

```{r}
library('MSEApDbi')
tmp <- tempdir()

ath <- system.file("extdata","MSEAp.Ath.pb.db_DATA.csv",package="MSEApDbi")
meta <- system.file("extdata","MSEAp.Ath.pb.db_METADATA.csv",package="MSEApDbi")
athDf <- read.csv(ath)
metaDf <- read.csv(meta)
# We need to avoid DOT from the column names (to query with the names)
names(athDf) <- gsub("\\.", "", names(athDf))
names(metaDf) <- gsub("\\.", "", names(metaDf))

makeMSEApPackage(pkgname = "MSEAp.Ath.pb.db", data=athDf, metadata=metaDf,
organism = "Arabidopsis thaliana", version = "0.99.0",
maintainer = "Kozo Nishida <kozo.nishida@gmail.com>", author = "Kozo Nishida",
destDir = tmp, license = "Artistic-2.0")

mseapPackageDir = paste(tmp, "MSEAp.Ath.pb.db", sep="/")
install.packages(mseapPackageDir, repos=NULL, type="source")

```

## columns, keytypes, and select

All MSEAp.XXX.pb.db package has same name object and it is instantiated by
MSEApDbclass. Many data access function for this object are implmented.
For example, columns returns the rows which we can retrieve in MSEAp.XXX.pb.db
packages. keytypes returns the rows which can be used as the optional parameter
in keys and select functions against MSEAp.XXX.pb.db packages.
select function returns the rows in particular columns, which are having
user-specified keys. This function returns the result as a dataframe.

```{r}
library(AnnotationDbi)
library(MSEAp.Ath.pb.db)

columns(MSEAp.Ath.pb.db)
keytypes(MSEAp.Ath.pb.db)

ids <- c('SMP0012018', 'SMP0012019')
select(MSEAp.Ath.pb.db, ids, "MetaboliteID", "PathBankID")
```

## Other functions

Other additional functions like species, dbInfo, and dbconn are available.
In each MSEAp.XXX.pb.db package, species function returns the common name.
dbInfo returns the information of the package.
dbfile returns the directory where sqlite file is stored.
dbschema returns the schema of database.
dbconn returns the connection to the sqlite database.

```{r}
species(MSEAp.Ath.pb.db)
dbInfo(MSEAp.Ath.pb.db)
dbfile(MSEAp.Ath.pb.db)
dbschema(MSEAp.Ath.pb.db)
dbconn(MSEAp.Ath.pb.db)
```


## References

1. Tsuyuzaki K, Morota G, Ishii M, Nakazato T, Miyazaki S, Nikaido I. MeSH ORA
framework: R/Bioconductor packages to support MeSH over-representation 
analysis. BMC bioinformatics. 2015 Dec;16(1):45.

# Session information {.unnumbered}

Here is the output of `sessionInfo()` on the system on which this
document was compiled:

```{r sessionInfo, echo=FALSE}
sessionInfo()
```